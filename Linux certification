ðŸ“‚ Certificate Authority Setup (3 Machine Lab: Root CA - Sub CA - Web Server)

â”œâ”€â”€ ðŸ” Root CA Setup (Machine: deb1)
â”‚   â”œâ”€â”€ mkdir certs crl csr newcerts private
â”‚   â”œâ”€â”€ chmod 700 private
â”‚   â”œâ”€â”€ touch index.txt index.txt.attr
â”‚   â”œâ”€â”€ echo 1000 > serial
â”‚   â”œâ”€â”€ echo 1000 > crlnumber
â”‚   â”œâ”€â”€ Download & edit rootca.cnf â†’ set Dir = /home/shuhari/ca
â”‚   â”œâ”€â”€ Install OpenSSL:
â”‚   â”‚   sudo apt install openssl
â”‚   â”œâ”€â”€ Generate Encrypted Private Key:
â”‚   â”‚   openssl genrsa -aes256 -out private/ca.key.pem 4096
â”‚   â”œâ”€â”€ chmod 400 private/ca.key.pem
â”‚   â””â”€â”€ Generate Self-Signed Root Certificate:
â”‚       openssl req -config rootca.cnf -key private/ca.key.pem -new -x509 -days 7300 -sha256 -extensions v3_ca -out certs/ca.cert.pem

â”œâ”€â”€ ðŸ§¾ Subordinate CA Setup (Machine: deb2)
â”‚   â”œâ”€â”€ mkdir subca && cd subca
â”‚   â”œâ”€â”€ mkdir certs crl csr newcerts private
â”‚   â”œâ”€â”€ chmod 700 private
â”‚   â”œâ”€â”€ touch index.txt index.txt.attr
â”‚   â”œâ”€â”€ echo 1000 > serial
â”‚   â”œâ”€â”€ echo 1000 > crlnumber
â”‚   â”œâ”€â”€ Download & edit subca.cnf â†’ set Dir = /home/shuhari/ca/subca
â”‚   â”œâ”€â”€ Generate Private Key:
â”‚   â”‚   openssl genrsa -out private/subca.key.pem 4096
â”‚   â”œâ”€â”€ chmod 400 private/subca.key.pem
â”‚   â”œâ”€â”€ Generate CSR:
â”‚   â”‚   openssl req -config subca.cnf -new -sha256 -key private/subca.key.pem -out csr/subca.csr.pem
â”‚   â”œâ”€â”€ Send CSR to Root CA (deb1)
â”‚   â”œâ”€â”€ On Root CA: Sign CSR
â”‚   â”‚   openssl ca -config rootca.cnf -extensions v3_intermediate_ca -days 3650 -notext -md sha256 -in subca/csr/subca.csr.pem -out subca/certs/subca.cert.pem
â”‚   â””â”€â”€ Copy subca.cert.pem back to Sub CA certs folder

â””â”€â”€ ðŸŒ Web Server Certificate (Machine: deb3)
    â”œâ”€â”€ mkdir certs && cd certs
    â”œâ”€â”€ Edit subca.cnf â†’ under [alt_name]:
    â”‚   DNS.1 = *.shuhari.local
    â”œâ”€â”€ Generate Private Key (no encryption):
    â”‚   openssl genrsa -out www.shuhari.local.key.pem 2048
    â”œâ”€â”€ chmod 400 www.shuhari.local.key.pem
    â”œâ”€â”€ Generate CSR:
    â”‚   openssl req -config subca.cnf -key www.shuhari.local.key.pem -new -sha256 -out www.shuhari.local.csr.pem
    â”‚   (CN = www.shuhari.local)
    â”œâ”€â”€ Send CSR to Sub CA (deb2)
    â”œâ”€â”€ ðŸ“¬ On Sub CA (deb2): Sign Web Server CSR
    â”‚   openssl ca -config subca.cnf -extensions server_cert -days 375 -notext -md sha256 -in csr/www.shuhari.local.csr.pem -out certs/www.shuhari.local.cert.pem
    â””â”€â”€ ðŸ”— Final Steps on Web Server (deb3)
        â”œâ”€â”€ Copy: www.shuhari.local.cert.pem, subca.cert.pem, ca.cert.pem â†’ deb3
        â”œâ”€â”€ Create Certificate Chain:
        â”‚   cat www.shuhari.local.cert.pem subca.cert.pem ca.cert.pem > www.shuhari.local.cert.chain.pem
        â”œâ”€â”€ Install Apache2:
        â”‚   sudo apt install apache2
        â”œâ”€â”€ Create directory:
        â”‚   sudo mkdir -p /etc/apache2/ssl
        â”œâ”€â”€ Copy certificate chain & private key to /etc/apache2/ssl/
        â”œâ”€â”€ Configure Apache to use:
        â”‚   SSLCertificateFile    /etc/apache2/ssl/www.shuhari.local.cert.chain.pem
        â”‚   SSLCertificateKeyFile /etc/apache2/ssl/www.shuhari.local.key.pem
        â””â”€â”€ Restart Apache:
            sudo systemctl restart apache2
